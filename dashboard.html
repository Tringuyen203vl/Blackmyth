<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Cáº­p Nháº­t Tá»± Äá»™ng</title>
    <style>
        /* ... (CÃ¡c pháº§n CSS hiá»‡n táº¡i cá»§a báº¡n) ... */
    </style>
    <script>
        let lastEntryID = null; // Biáº¿n Ä‘á»ƒ theo dÃµi entry ID cuá»‘i cÃ¹ng Ä‘Ã£ Ä‘Æ°á»£c thÃªm vÃ o báº£ng

        // Biáº¿n Ä‘á»ƒ xÃ¡c Ä‘á»‹nh ngÃ y káº¿t thÃºc tá»‘i Ä‘a
        let maxEndDate = formatDate(new Date()); // 'DD/MM/YYYY HH:MM:SS'

        // HÃ m Ä‘á»ƒ Ä‘á»‹nh dáº¡ng Ä‘á»‘i tÆ°á»£ng Date thÃ nh chuá»—i 'DD/MM/YYYY HH:MM:SS'
        function formatDate(date) {
            let day = String(date.getDate()).padStart(2, '0');
            let month = String(date.getMonth() + 1).padStart(2, '0'); // ThÃ¡ng báº¯t Ä‘áº§u tá»« 0
            let year = date.getFullYear();
            let hours = String(date.getHours()).padStart(2, '0');
            let minutes = String(date.getMinutes()).padStart(2, '0');
            let seconds = String(date.getSeconds()).padStart(2, '0');
            return `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
        }

        // HÃ m Ä‘á»ƒ chuyá»ƒn Ä‘á»•i chuá»—i 'DD/MM/YYYY' thÃ nh Ä‘á»‘i tÆ°á»£ng Date
        function parseDate(str) {
            const parts = str.split('/');
            if (parts.length !== 3) return null;
            const day = parseInt(parts[0], 10);
            const month = parseInt(parts[1], 10) - 1; // ThÃ¡ng báº¯t Ä‘áº§u tá»« 0
            const year = parseInt(parts[2], 10);
            const date = new Date(year, month, day);
            if (date.getFullYear() !== year || date.getMonth() !== month || date.getDate() !== day) {
                return null; // NgÃ y khÃ´ng há»£p lá»‡
            }
            return date;
        }

        // HÃ m Ä‘á»ƒ Ä‘Äƒng xuáº¥t ngÆ°á»i dÃ¹ng
        function logout() {
            // XÃ³a tráº¡ng thÃ¡i Ä‘Äƒng nháº­p khá»i sessionStorage
            sessionStorage.removeItem('isLoggedIn');
            // Hoáº·c báº¡n cÃ³ thá»ƒ xÃ³a toÃ n bá»™ sessionStorage náº¿u khÃ´ng cáº§n giá»¯ dá»¯ liá»‡u khÃ¡c
            // sessionStorage.clear();
            
            // Chuyá»ƒn hÆ°á»›ng ngÆ°á»i dÃ¹ng vá» trang Ä‘Äƒng nháº­p
            window.location.href = 'https://tringuyen203vl.github.io/Blackmyth/';
        }

        // HÃ m Ä‘á»ƒ táº¡o hÃ ng má»›i trong báº£ng
        // ThÃªm tham sá»‘ insertAtTop Ä‘á»ƒ xÃ¡c Ä‘á»‹nh vá»‹ trÃ­ chÃ¨n hÃ ng
        function addRowToTable(field1, field2, timestamp, insertAtTop = false) {
            const table = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow(insertAtTop ? 0 : -1); // 0 Ä‘á»ƒ chÃ¨n Ä‘áº§u, -1 Ä‘á»ƒ chÃ¨n cuá»‘i

            const cell1 = newRow.insertCell(0);
            const cell2 = newRow.insertCell(1);
            const cell3 = newRow.insertCell(2);

            cell1.innerText = field1;
            cell2.innerText = field2;
            cell3.innerText = timestamp;
        }

        // HÃ m Ä‘á»ƒ láº¥y dá»¯ liá»‡u tá»« ThingSpeak
        async function fetchData() {
            const channelID = '2783657'; // Thay báº±ng Channel ID cá»§a báº¡n
            const apiKey = 'FZUQDUYN7ON76T8P';  // Thay báº±ng API Read Key cá»§a báº¡n
            const url = `https://api.thingspeak.com/channels/${channelID}/feeds.json?api_key=${apiKey}&results=20`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const data = await response.json();
                const feeds = data.feeds;

                if (feeds.length === 0) {
                    console.warn('KhÃ´ng cÃ³ dá»¯ liá»‡u tá»« ThingSpeak.');
                    return;
                }

                const latestFeed = feeds[feeds.length - 1];

                // Cáº­p nháº­t dá»¯ liá»‡u lÃªn trang web
                document.getElementById('field1').innerText = latestFeed.field1 || 'KhÃ´ng cÃ³ dá»¯ liá»‡u';
                document.getElementById('field2').innerText = latestFeed.field2 || 'KhÃ´ng cÃ³ dá»¯ liá»‡u';
                // XÃ³a dÃ²ng cáº­p nháº­t 'timestamp'
                // document.getElementById('timestamp').innerText = latestFeed.created_at ? formatDate(new Date(latestFeed.created_at)) : 'KhÃ´ng cÃ³ dá»¯ liá»‡u';

                // Cáº­p nháº­t dá»¯ liá»‡u trong báº£ng náº¿u báº£ng Ä‘ang hiá»ƒn thá»‹
                if (document.getElementById('dataTable').style.display === 'table') {
                    // Kiá»ƒm tra xem entry Ä‘Ã£ tá»“n táº¡i chÆ°a
                    if (latestFeed.entry_id !== lastEntryID) {
                        addRowToTable(
                            latestFeed.field1 || 'KhÃ´ng cÃ³ dá»¯ liá»‡u',
                            latestFeed.field2 || 'KhÃ´ng cÃ³ dá»¯ liá»‡u',
                            latestFeed.created_at ? formatDate(new Date(latestFeed.created_at)) : 'KhÃ´ng cÃ³ dá»¯ liá»‡u',
                            true // ChÃ¨n vÃ o Ä‘áº§u báº£ng
                        );
                        lastEntryID = latestFeed.entry_id;
                    }
                }
            } catch (error) {
                console.error('Lá»—i khi láº¥y dá»¯ liá»‡u:', error);
                document.getElementById('field1').innerText = 'Lá»—i';
                document.getElementById('field2').innerText = 'Lá»—i';
                // document.getElementById('timestamp').innerText = 'Lá»—i';
            }
        }

        // HÃ m Ä‘á»ƒ láº¥y táº¥t cáº£ dá»¯ liá»‡u tá»« ThingSpeak vÃ  hiá»ƒn thá»‹ trong báº£ng
        async function fetchAllData() {
            const channelID = '2783657'; // Thay báº±ng Channel ID cá»§a báº¡n
            const apiKey = 'FZUQDUYN7ON76T8P';  // Thay báº±ng API Read Key cá»§a báº¡n
            const url = `https://api.thingspeak.com/channels/${channelID}/feeds.json?api_key=${apiKey}&results=8000`; // TÄƒng 'results' Ä‘á»ƒ láº¥y nhiá»u dá»¯ liá»‡u hÆ¡n

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const data = await response.json();
                let feeds = data.feeds;

                if (feeds.length === 0) {
                    console.warn('KhÃ´ng cÃ³ dá»¯ liá»‡u tá»« ThingSpeak.');
                    return;
                }

                // Äáº£o ngÆ°á»£c máº£ng feeds Ä‘á»ƒ cÃ³ má»¥c má»›i nháº¥t lÃªn trÃªn cÃ¹ng
                feeds = feeds.reverse();

                // XÃ³a dá»¯ liá»‡u cÅ© trong báº£ng
                const tableBody = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
                tableBody.innerHTML = '';

                // ThÃªm cÃ¡c dÃ²ng vÃ o báº£ng
                feeds.forEach(feed => {
                    const createdAtDate = feed.created_at ? formatDate(new Date(feed.created_at)) : 'KhÃ´ng cÃ³ dá»¯ liá»‡u';
                    addRowToTable(
                        feed.field1 || 'KhÃ´ng cÃ³ dá»¯ liá»‡u',
                        feed.field2 || 'KhÃ´ng cÃ³ dá»¯ liá»‡u',
                        createdAtDate,
                        false // ChÃ¨n vÃ o cuá»‘i báº£ng (sau khi Ä‘Ã£ Ä‘áº£o ngÆ°á»£c, Ä‘Ã¢y lÃ  Ä‘Ãºng thá»© tá»±)
                    );
                    lastEntryID = feed.entry_id; // Cáº­p nháº­t entry ID cuá»‘i cÃ¹ng
                });

                // Hiá»ƒn thá»‹ báº£ng dá»¯ liá»‡u
                document.getElementById('dataTable').style.display = 'table';
            } catch (error) {
                console.error('Lá»—i khi láº¥y dá»¯ liá»‡u:', error);
                document.getElementById('filterMessage').innerText = 'CÃ³ lá»—i xáº£y ra khi táº£i dá»¯ liá»‡u.';
                // áº¨n báº£ng náº¿u cÃ³ lá»—i
                document.getElementById('dataTable').style.display = 'none';
            }
        }

        // HÃ m Ä‘á»ƒ láº¥y dá»¯ liá»‡u lá»‹ch sá»­ vÃ  táº¡o báº£ng
        async function fetchHistoricalData(startDateStr, endDateStr) {
            const channelID = '2783657'; // Thay báº±ng Channel ID cá»§a báº¡n
            const apiKey = 'FZUQDUYN7ON76T8P';  // Thay báº±ng API Read Key cá»§a báº¡n

            // Chuyá»ƒn Ä‘á»•i chuá»—i ngÃ y sang Ä‘á»‘i tÆ°á»£ng Date
            const startDate = parseDate(startDateStr);
            const endDate = parseDate(endDateStr);

            if (!startDate || !endDate) {
                document.getElementById('filterMessage').style.color = 'red';
                document.getElementById('filterMessage').innerText = 'Äá»‹nh dáº¡ng ngÃ y khÃ´ng há»£p lá»‡.';
                document.getElementById('dataTable').style.display = 'none';
                return;
            }

            // Construct start and end datetime in ISO format
            const startDateTime = `${startDate.getFullYear()}-${String(startDate.getMonth()+1).padStart(2, '0')}-${String(startDate.getDate()).padStart(2, '0')}T00:00:00Z`;
            const endDateTime = `${endDate.getFullYear()}-${String(endDate.getMonth()+1).padStart(2, '0')}-${String(endDate.getDate()).padStart(2, '0')}T23:59:59Z`;

            const url = `https://api.thingspeak.com/channels/${channelID}/feeds.json?api_key=${apiKey}&start=${startDateTime}&end=${endDateTime}&timezone=UTC`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const data = await response.json();
                let feeds = data.feeds;

                if (feeds.length === 0) {
                    // Hiá»ƒn thá»‹ thÃ´ng bÃ¡o khÃ´ng cÃ³ dá»¯ liá»‡u
                    document.getElementById('filterMessage').innerText = 'Dá»¯ liá»‡u khÃ´ng tá»“n táº¡i.';
                    // áº¨n báº£ng náº¿u Ä‘ang hiá»ƒn thá»‹
                    document.getElementById('dataTable').style.display = 'none';
                    return;
                } else {
                    document.getElementById('filterMessage').innerText = '';
                }

                // Lá»c dá»¯ liá»‡u khÃ´ng vÆ°á»£t quÃ¡ maxEndDate
                const maxAllowedDate = parseDate(maxEndDate.split(' ')[0]); // Chá»‰ so sÃ¡nh ngÃ y
                feeds = feeds.filter(feed => {
                    if (feed.created_at) {
                        const feedDate = new Date(feed.created_at);
                        const feedDay = new Date(feedDate.getFullYear(), feedDate.getMonth(), feedDate.getDate());
                        return feedDay <= maxAllowedDate;
                    }
                    return false;
                });

                if (feeds.length === 0) {
                    document.getElementById('filterMessage').innerText = 'KhÃ´ng cÃ³ dá»¯ liá»‡u sau khi lá»c.';
                    document.getElementById('dataTable').style.display = 'none';
                    return;
                }

                // XÃ³a dá»¯ liá»‡u cÅ© trong báº£ng
                const tableBody = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
                tableBody.innerHTML = '';

                // ThÃªm cÃ¡c dÃ²ng vÃ o báº£ng
                feeds.forEach(feed => {
                    const createdAtDate = feed.created_at ? formatDate(new Date(feed.created_at)) : 'KhÃ´ng cÃ³ dá»¯ liá»‡u';
                    addRowToTable(
                        feed.field1 || 'KhÃ´ng cÃ³ dá»¯ liá»‡u',
                        feed.field2 || 'KhÃ´ng cÃ³ dá»¯ liá»‡u',
                        createdAtDate,
                        false // ChÃ¨n vÃ o cuá»‘i báº£ng
                    );
                    lastEntryID = feed.entry_id; // Cáº­p nháº­t entry ID cuá»‘i cÃ¹ng
                });

                // Hiá»ƒn thá»‹ báº£ng dá»¯ liá»‡u
                document.getElementById('dataTable').style.display = 'table';
            } catch (error) {
                console.error('Lá»—i khi láº¥y dá»¯ liá»‡u lá»‹ch sá»­:', error);
                document.getElementById('filterMessage').innerText = 'CÃ³ lá»—i xáº£y ra khi lá»c dá»¯ liá»‡u.';
                // áº¨n báº£ng náº¿u cÃ³ lá»—i
                document.getElementById('dataTable').style.display = 'none';
            }
        }

        // HÃ m Ä‘á»ƒ toggle hiá»ƒn thá»‹ báº£ng
        async function toggleTable() {
            const dataTable = document.getElementById('dataTable');
            const toggleButton = document.getElementById('toggleButton');
            if (dataTable.style.display === 'none' || dataTable.style.display === '') {
                dataTable.style.display = 'table';
                toggleButton.innerText = 'áº¨n báº£ng dá»¯ liá»‡u';
                await fetchAllData(); // Fetch all data without date filters
            } else {
                dataTable.style.display = 'none';
                toggleButton.innerText = 'Hiá»ƒn thá»‹ danh sÃ¡ch';
            }
        }

        // HÃ m Ä‘á»ƒ lá»c dá»¯ liá»‡u theo ngÃ y thÃ¡ng
        async function filterData() {
            const startDateInput = document.getElementById('startDate').value;
            let endDateInput = document.getElementById('endDate').value;
            const filterMessage = document.getElementById('filterMessage');

            // Kiá»ƒm tra xem cáº£ hai trÆ°á»ng Ä‘Ã£ Ä‘Æ°á»£c nháº­p Ä‘áº§y Ä‘á»§ chÆ°a
            if (startDateInput === '' || endDateInput === '') {
                filterMessage.style.color = 'red';
                filterMessage.innerText = 'Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ ngÃ y báº¯t Ä‘áº§u vÃ  káº¿t thÃºc.';
                return;
            }

            // Kiá»ƒm tra logic ngÃ y thÃ¡ng
            const startDate = parseDate(startDateInput);
            const endDate = parseDate(endDateInput);

            if (!startDate || !endDate) {
                filterMessage.style.color = 'red';
                filterMessage.innerText = 'Äá»‹nh dáº¡ng ngÃ y khÃ´ng há»£p lá»‡.';
                return;
            }

            if (startDate > endDate) {
                filterMessage.style.color = 'red';
                filterMessage.innerText = 'NgÃ y báº¯t Ä‘áº§u khÃ´ng Ä‘Æ°á»£c lá»›n hÆ¡n ngÃ y káº¿t thÃºc.';
                return;
            }

            // Kiá»ƒm tra vÃ  giá»›i háº¡n ngÃ y káº¿t thÃºc khÃ´ng vÆ°á»£t quÃ¡ maxEndDate
            const maxAllowedDate = parseDate(maxEndDate.split(' ')[0]); // Chá»‰ so sÃ¡nh ngÃ y
            if (endDate > maxAllowedDate) {
                endDateInput = maxAllowedDate;
                document.getElementById('endDate').value = formatDate(maxAllowedDate).split(' ')[0]; // Cáº­p nháº­t láº¡i giÃ¡ trá»‹ trong input (chá»‰ ngÃ y)
                filterMessage.style.color = 'orange';
                filterMessage.innerText = `NgÃ y káº¿t thÃºc Ä‘Ã£ Ä‘Æ°á»£c giá»›i háº¡n táº¡i ${formatDate(maxAllowedDate).split(' ')[0]}.`;
            } else {
                filterMessage.style.color = 'green';
                filterMessage.innerText = '';
            }

            // Gá»i hÃ m fetchHistoricalData vá»›i ngÃ y Ä‘Ã£ chá»n
            await fetchHistoricalData(startDateInput, endDateInput);
        }

        // HÃ m Ä‘á»ƒ gá»­i lá»‡nh má»Ÿ cá»­a kháº©n cáº¥p lÃªn ESP32 Web Server báº±ng cÃ¡ch chuyá»ƒn hÆ°á»›ng trÃ¬nh duyá»‡t
        function sendEmergencyOpenCommand() {
            const esp32URL = 'http://192.168.1.8/emergency_open'; // Äá»‹a chá»‰ IP cá»§a ESP32

            // Má»Ÿ ESP32 endpoint Ä‘á»ƒ kÃ­ch hoáº¡t má»Ÿ cá»­a
            window.location.href = esp32URL;

            // Sau 1 giÃ¢y, quay láº¡i dashboard.html náº¿u cáº§n
            setTimeout(function() {
                window.location.href = 'dashboard.html'; // Thay báº±ng tÃªn file dashboard cá»§a báº¡n náº¿u khÃ¡c
            }, 1000); // 1000 milliseconds = 1 giÃ¢y
        }

        // HÃ m Ä‘á»ƒ gá»­i lá»‡nh Ä‘Äƒng kÃ½ vÃ¢n tay lÃªn ESP32 Web Server báº±ng cÃ¡ch chuyá»ƒn hÆ°á»›ng trÃ¬nh duyá»‡t
        function sendRegisterFingerprintCommand() {
            const esp32URL = 'http://192.168.1.8/register_fingerprint'; // Äá»‹a chá»‰ IP cá»§a ESP32

            // Má»Ÿ ESP32 endpoint Ä‘á»ƒ kÃ­ch hoáº¡t Ä‘Äƒng kÃ½ vÃ¢n tay
            window.location.href = esp32URL;

            // (TÃ¹y chá»n) Sau má»™t khoáº£ng thá»i gian, quay láº¡i dashboard.html náº¿u cáº§n
            // setTimeout(function() {
            //     window.location.href = 'dashboard.html'; // Thay báº±ng tÃªn file dashboard cá»§a báº¡n náº¿u khÃ¡c
            // }, 1000); // 1000 milliseconds = 1 giÃ¢y
        }

        // HÃ m Ä‘á»ƒ thiáº¿t láº­p maxEndDate tá»« input cá»§a ngÆ°á»i dÃ¹ng
        function setMaxEndDate() {
            const maxEndDateInput = document.getElementById('maxEndDateInput').value;
            const setMaxEndDateMessage = document.getElementById('setMaxEndDateMessage');

            if (maxEndDateInput === '') {
                setMaxEndDateMessage.style.color = 'red';
                setMaxEndDateMessage.innerText = 'Vui lÃ²ng chá»n ngÃ y.';
                return;
            }

            // Kiá»ƒm tra Ä‘á»‹nh dáº¡ng ngÃ y
            const parsedMaxEndDate = parseDate(maxEndDateInput);
            if (!parsedMaxEndDate) {
                setMaxEndDateMessage.style.color = 'red';
                setMaxEndDateMessage.innerText = 'Äá»‹nh dáº¡ng ngÃ y khÃ´ng há»£p lá»‡.';
                return;
            }

            // Cáº­p nháº­t biáº¿n maxEndDate
            maxEndDate = formatDate(parsedMaxEndDate); // Bao gá»“m cáº£ giá», phÃºt, giÃ¢y

            // Cáº­p nháº­t thuá»™c tÃ­nh max cho input endDate
            const endDateInputElement = document.getElementById('endDate');
            endDateInputElement.setAttribute('max', maxEndDate.split(' ')[0]); // Chá»‰ Ä‘áº·t pháº§n ngÃ y

            setMaxEndDateMessage.style.color = 'green';
            setMaxEndDateMessage.innerText = `NgÃ y káº¿t thÃºc tá»‘i Ä‘a Ä‘Ã£ Ä‘Æ°á»£c thiáº¿t láº­p táº¡i ${maxEndDate.split(' ')[0]}.`;
        }

        // HÃ m kiá»ƒm tra tráº¡ng thÃ¡i Ä‘Äƒng nháº­p
        function checkLoginStatus() {
            // Kiá»ƒm tra xem ngÆ°á»i dÃ¹ng Ä‘Ã£ Ä‘Äƒng nháº­p hay chÆ°a
            const isLoggedIn = sessionStorage.getItem('isLoggedIn');
            if (isLoggedIn !== 'true') {
                // Náº¿u chÆ°a Ä‘Äƒng nháº­p, chuyá»ƒn hÆ°á»›ng vá» trang Ä‘Äƒng nháº­p
                window.location.href = 'https://tringuyen203vl.github.io/Blackmyth/';
            }
        }

        // HÃ m Ä‘á»ƒ khá»Ÿi Ä‘á»™ng quÃ¡ trÃ¬nh tá»± Ä‘á»™ng cáº­p nháº­t
        function startAutoUpdate() {
            fetchData(); // Láº¥y dá»¯ liá»‡u ngay láº­p tá»©c khi trang táº£i
            setInterval(fetchData, 3000); // Láº¥y dá»¯ liá»‡u má»—i 3 giÃ¢y
        }

        // HÃ m Ä‘á»ƒ cáº­p nháº­t Ä‘á»“ng há»“ trá»±c tiáº¿p
        function startLiveClock() {
            const liveClockElement = document.getElementById('liveClock');
            function updateClock() {
                const now = new Date();
                const day = String(now.getDate()).padStart(2, '0');
                const month = String(now.getMonth() + 1).padStart(2, '0'); // ThÃ¡ng báº¯t Ä‘áº§u tá»« 0
                const year = now.getFullYear();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                liveClockElement.innerText = `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
            }
            updateClock(); // Cáº­p nháº­t ngay láº­p tá»©c khi táº£i trang
            setInterval(updateClock, 1000); // Cáº­p nháº­t má»—i giÃ¢y
        }

        // HÃ m Ä‘á»ƒ tá»± Ä‘á»™ng chÃ¨n dáº¥u '/' vÃ o cÃ¡c trÆ°á»ng nháº­p ngÃ y
        function autoFormatDate(input) {
            input.addEventListener('input', function(e) {
                let value = input.value.replace(/\D/g, ''); // Loáº¡i bá» cÃ¡c kÃ½ tá»± khÃ´ng pháº£i sá»‘
                if (value.length > 8) {
                    value = value.slice(0,8);
                }
                let formattedValue = '';
                if (value.length > 0) {
                    formattedValue += value.slice(0,2);
                }
                if (value.length >= 3) {
                    formattedValue += '/' + value.slice(2,4);
                }
                if (value.length >=5) {
                    formattedValue += '/' + value.slice(4,8);
                }
                input.value = formattedValue;
            });

            // Kiá»ƒm tra khi ngÆ°á»i dÃ¹ng nháº¥n phÃ­m Backspace Ä‘á»ƒ loáº¡i bá» dáº¥u '/'
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Backspace') {
                    const value = input.value;
                    if (value.endsWith('/')) {
                        e.preventDefault();
                        input.value = value.slice(0, -1);
                    }
                }
            });
        }

        // Khi trang táº£i
        window.addEventListener('load', function() {
            // Thiáº¿t láº­p ngÃ y káº¿t thÃºc tá»‘i Ä‘a cho input endDate
            const endDateInputElement = document.getElementById('endDate');
            endDateInputElement.setAttribute('max', maxEndDate.split(' ')[0]); // Chá»‰ Ä‘áº·t pháº§n ngÃ y

            // Ãp dá»¥ng tá»± Ä‘á»™ng Ä‘á»‹nh dáº¡ng ngÃ y cho cÃ¡c trÆ°á»ng nháº­p ngÃ y
            const dateInputs = ['startDate', 'endDate', 'maxEndDateInput'];
            dateInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    autoFormatDate(input);
                }
            });

            // Kiá»ƒm tra Ä‘Äƒng nháº­p
            checkLoginStatus();

            // Khá»Ÿi Ä‘á»™ng tá»± Ä‘á»™ng cáº­p nháº­t
            startAutoUpdate();

            // Khá»Ÿi Ä‘á»™ng Ä‘á»“ng há»“ trá»±c tiáº¿p
            startLiveClock();

            // ThÃªm sá»± kiá»‡n cho nÃºt "ÄÄƒng Xuáº¥t"
            const logoutBtn = document.getElementById('logoutButton');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', logout);
            }

            // ThÃªm sá»± kiá»‡n cho nÃºt "Hiá»ƒn thá»‹ danh sÃ¡ch"
            const toggleBtn = document.getElementById('toggleButton');
            if (toggleBtn) {
                toggleBtn.addEventListener('click', toggleTable);
            }

            // ThÃªm sá»± kiá»‡n cho nÃºt "Lá»c dá»¯ liá»‡u"
            const filterBtn = document.getElementById('filterButton');
            if (filterBtn) {
                filterBtn.addEventListener('click', filterData);
            }

            // ThÃªm sá»± kiá»‡n cho nÃºt "Má»Ÿ Cá»­a Kháº©n Cáº¥p"
            const emergencyBtn = document.getElementById('emergencyOpenButton');
            if (emergencyBtn) {
                emergencyBtn.addEventListener('click', sendEmergencyOpenCommand);
            }

            // ThÃªm sá»± kiá»‡n cho nÃºt "Thiáº¿t láº­p maxEndDate"
            const setMaxEndDateBtn = document.getElementById('setMaxEndDateButton');
            if (setMaxEndDateBtn) {
                setMaxEndDateBtn.addEventListener('click', setMaxEndDate);
            }

            // ThÃªm sá»± kiá»‡n cho nÃºt "ÄÄƒng KÃ½ VÃ¢n Tay"
            const registerFingerprintBtn = document.getElementById('registerFingerprintButton');
            if (registerFingerprintBtn) {
                registerFingerprintBtn.addEventListener('click', sendRegisterFingerprintCommand);
            }
        });
    </script>
</head>
<body>
    <h1>
        kkkk
        <button id="logoutButton">ÄÄƒng Xuáº¥t</button>
    </h1>
    <div class="data-container">
        <div class="data-item">
            <h2>ESP ID</h2>
            <p id="field1">Äang táº£i...</p>
        </div>
        <div class="data-item">
            <h2>Fingerprint ID</h2>
            <p id="field2">Äang táº£i...</p>
        </div>
        <div class="data-item" style="width: 100%; text-align: center;">
            <h2>Thá»i gian</h2>
            <!-- XÃ³a pháº§n timestamp khÃ´ng cáº­p nháº­t -->
            <!-- <p id="timestamp" class="timestamp">Äang táº£i...</p> -->
            <!-- Giá»¯ láº¡i Ä‘á»“ng há»“ trá»±c tiáº¿p -->
            <p id="liveClock" class="live-clock"></p>
        </div>
    </div>

    <!-- Thanh nháº­p ngÃ y vÃ  nÃºt lá»c dá»¯ liá»‡u -->
    <div class="filter-container">
        <label for="startDate">NgÃ y báº¯t Ä‘áº§u:</label>
        <input type="text" id="startDate" placeholder="DD/MM/YYYY" pattern="\d{2}/\d{2}/\d{4}" title="Äá»‹nh dáº¡ng: DD/MM/YYYY">
        <label for="endDate">NgÃ y káº¿t thÃºc:</label>
        <input type="text" id="endDate" placeholder="DD/MM/YYYY" pattern="\d{2}/\d{2}/\d{4}" title="Äá»‹nh dáº¡ng: DD/MM/YYYY">
        <button id="filterButton">Lá»c dá»¯ liá»‡u</button>
        <div id="filterMessage" class="filter-message"></div>
    </div>

    <!-- TrÆ°á»ng nháº­p Ä‘á»ƒ thiáº¿t láº­p maxEndDate -->
    <div class="filter-container">
        <label for="maxEndDateInput">NgÃ y káº¿t thÃºc tá»‘i Ä‘a:</label>
        <input type="text" id="maxEndDateInput" placeholder="DD/MM/YYYY" pattern="\d{2}/\d{2}/\d{4}" title="Äá»‹nh dáº¡ng: DD/MM/YYYY">
        <button id="setMaxEndDateButton">Thiáº¿t láº­p</button>
        <div id="setMaxEndDateMessage" class="filter-message"></div>
    </div>

    <!-- NÃºt Ä‘á»ƒ hiá»ƒn thá»‹ báº£ng dá»¯ liá»‡u -->
    <button id="toggleButton">Hiá»ƒn thá»‹ danh sÃ¡ch</button>

    <!-- NÃºt Má»Ÿ Cá»­a Kháº©n Cáº¥p -->
    <button id="emergencyOpenButton">Má»Ÿ Cá»­a Kháº©n Cáº¥p</button>

    <!-- NÃºt ÄÄƒng KÃ½ VÃ¢n Tay -->
    <button id="registerFingerprintButton">ÄÄƒng KÃ½ VÃ¢n Tay</button>

    <!-- Báº£ng dá»¯ liá»‡u -->
    <table id="dataTable">
        <thead>
            <tr>
                <th>ESP ID</th>
                <th>Fingerprint ID</th>
                <th>Thá»i gian</th>
            </tr>
        </thead>
        <tbody>
            <!-- Dá»¯ liá»‡u sáº½ Ä‘Æ°á»£c thÃªm vÃ o Ä‘Ã¢y -->
        </tbody>
    </table>

    <!-- Thanh thÃ´ng tin cháº¡y -->
    <div class="running-info">
        <div class="running-text">
            ğŸ“§ Email: your-email@example.com | ğŸ“ Sá»‘ Ä‘iá»‡n thoáº¡i: +84 987 654 321 | ğŸ  Äá»‹a chá»‰: 456 ÄÆ°á»ng DEF, Quáº­n UVW, ThÃ nh phá»‘ HÃ  Ná»™i &nbsp;&nbsp;&nbsp;
            ğŸ“§ Email: your-email@example.com | ğŸ“ Sá»‘ Ä‘iá»‡n thoáº¡i: +84 987 654 321 | ğŸ  Äá»‹a chá»‰: 456 ÄÆ°á»ng DEF, Quáº­n UVW, ThÃ nh phá»‘ HÃ  Ná»™i
        </div>
    </div>
</body>
</html>
